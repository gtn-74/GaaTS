# git コミット履歴が綺麗とは？

## 綺麗なコミット履歴って?

- コミットが一貫性を持っている

目的を持ってコミットされている。

コミットメッセージがわかりやすくて、変更内容を正確に伝えられている

冗長じゃないことも大切

コミットの粒度も大切

バグの特定が早まり、修正が迅速になる

| 項目               | 良いコミット履歴の例                                                          | 悪いコミット履歴の例                                             |
| ------------------ | ----------------------------------------------------------------------------- | ---------------------------------------------------------------- |
| コミットメッセージ | 「ユーザーログイン機能のバグ修正」 <br>「ユーザー登録フォームのデザイン改善」 | 「修正」 <br>「更新」                                            |
| コミットの粒度     | 各コミットが具体的な変更に対応し、明確な目的を持っている                      | 一つのコミットに複数の変更が含まれている、または変更が細かすぎる |
| 変更内容           | 特定の機能追加やバグ修正にフォーカスし、必要な変更のみを含む                  | 無関係な変更が含まれている、または大規模な変更が一度に行われる   |
| 追跡とレビュー     | 変更内容が明確であり、レビューが容易                                          | 変更内容が曖昧であり、レビューが困難                             |
| 一貫性             | コミット履歴全体が一貫しており、フォーマットが統一されている                  | コミットメッセージのフォーマットがバラバラで、一貫性がない       |

## コミットは意思決定の最小単位になっている

pj の透明性、効率性に直結する
→CM（コミットメッセージ）をみるだけでその改修に関わるファイルを閲覧すれば良いとわかるので、
砂漠の中で金を探すようなことをしなくて良くなる

## 意思決定の最小単位としてのコミット重要性

同ファイルで**feature**と**fix**を行ってしまった場合でもコミット分けできる

- [コミットの整理に git add -p を使おう](https://qiita.com/kato-hiroaki/items/527696da016d783c4af1)

  \*GUI でもできる

| 具体的な方法                   | 説明                                                                           | 例                                                       |
| ------------------------------ | ------------------------------------------------------------------------------ | -------------------------------------------------------- |
| 変更内容の確認                 | コミット前に変更内容を確認し、意図しない変更が含まれていないかをチェックする。 | `git diff` を使用して変更内容を確認する。                |
| 選択的ステージング             | 特定の変更のみをステージングし、一度にまとめてコミットしない。                 | `git add -p` を使用して部分的に変更をステージングする。  |
| コミットの分割                 | 一つの大きな変更を複数の小さなコミットに分割する。                             | 機能追加とバグ修正を別々のコミットにする。               |
| コミットメッセージの明確化     | 各コミットメッセージが具体的で明確な内容を持つようにする。                     | 「ログイン機能のエラーハンドリング追加」など。           |
| レビューの徹底                 | コミット前にコードレビューを行い、意図しない変更が含まれていないか確認する。   | プルリクエストを作成し、レビューを依頼する。             |
| 継続的インテグレーションの活用 | CI ツールを使ってコミットごとに自動テストを実施し、変更の影響を確認する。      | GitHub Actions や Jenkins を使って自動テストを実行する。 |

```git
 // hunk(変更のかたまり)をステージングする
y - stage this hunk

 // ステージングせずスキップする
n - do not stage this hunk

 // 以降の変更をスキップする（ステージングさせない）
q - quit; do not stage this hunk or any of the remaining ones

 // 差分をさらに細分化できる
s - split the current hunk into smaller hunks

// 行単位で変更、選択
e - manually edit the current hunk
```

## 意思決定を反映させるコミットメッセージの書き方

× : 「バグ修正」や「新機能追加」などの一般的な表現ではなく

◯ : 「ログイン画面のバグ修正」

## 分かりやすいコミットメッセージを書くためのガイドライン

| ガイドライン             | 説明                                                                         | 例                                                                                                                                                     |
| ------------------------ | ---------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 動詞で始める             | コミットメッセージは動詞で始め、具体的なアクションを表現する。               | 「追加」「修正」「削除」など                                                                                                                           |
| 簡潔かつ具体的           | コミットメッセージは短く、具体的に変更内容を伝える。                         | 「ログイン機能のバグ修正」<br>「ユーザー登録フォームのデザイン改善」                                                                                   |
| 変更の理由を説明する     | 必要に応じて、変更の背景や理由を簡潔に説明する。                             | 「バグ#123 を修正: ログイン失敗時のエラーメッセージを改善」                                                                                            |
| 一貫したフォーマット     | プロジェクト全体で統一されたフォーマットを使用する。                         | 「[カテゴリ] 詳細: 説明」<br>例:「[バグ修正] ログインエラー処理の改善」                                                                                |
| 関連チケット番号を含める | プロジェクト管理ツールのチケット番号を含めて、関連するタスクとリンクさせる。 | 「#123 ログイン機能のバグ修正」                                                                                                                        |
| 詳細な説明を追加         | 変更内容が複雑な場合は、コミットメッセージの本文に詳細な説明を追加する。     | 「ログイン失敗時のエラーメッセージを改善しました。<br>ユーザーが間違ったパスワードを入力した際に、具体的なエラーメッセージを表示するようにしました。」 |

トラッキング [~1]

[~1]: 追跡

## 参考

- [コミットメッセージ参考](https://qiita.com/ryuuya0921/items/588f997ca4a2aff880bd)
- [コミットの整理に git add -p を使おう](https://qiita.com/kato-hiroaki/items/527696da016d783c4af1)
